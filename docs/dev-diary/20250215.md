# 2025年2月15日 开发日记

## 烘焙曲线数据显示问题的解决方案

### 核心经验

在解决烘焙过程记录的曲线图显示问题时，有两个关键经验：

1. **数据流分离**：温度曲线和失重率曲线的数据流必须完全分离

2. **边距调整**：合理设置图表边距确保所有元素完整显示

### 边距调整最佳实践

经过实际调试，发现以下配置效果最好：

```typescript
// 1. 整体图表容器边距
<LineChart
  margin={{
    top: 20,     // 较小的顶部边距让图表更紧凑
    right: 10,   // 适中的右侧边距
    left: 10,    // 较小的左侧边距
    bottom: 10   // 较小的底部边距
  }}
>
  {/* 2. Y轴标签位置 */}
  <YAxis
    label={{
      value: '失重率 (%)',
      angle: -90,
      position: 'insideLeft',
      offset: 10   // 正值使标签向右移，更靠近图表
    }}
  />
</LineChart>
```

这个配置的优点：
1. 通过减小四周边距，让图表更加紧凑
2. Y轴标签向右偏移，避免被切断，同时保持与图表的紧凑关系
3. 整体视觉效果更加协调

### 具体实现要点

1. **分离数据状态**
```typescript
// 失重率相关状态
const [weightLossPoints, setWeightLossPoints] = useState<WeightLossPoint[]>([])
const [currentWeight, setCurrentWeight] = useState<number>(0)

// 温度相关状态
const [temperaturePoints, setTemperaturePoints] = useState<TemperaturePoint[]>([])
const [currentTemperature, setCurrentTemperature] = useState<number>(0)
```

2. **分离数据结构**
```typescript
// 失重率数据点结构
interface WeightLossPoint {
  time: number
  weight: number
  lossRate: number
  tag?: string
}

// 温度数据点结构
interface TemperaturePoint {
  time: number
  temperature: number
  tag?: string
}
```

3. **分离数据记录逻辑**
```typescript
// 记录失重率数据
const handleWeightLossRecord = () => {
  if (!isRecording || !currentWeight || !formData.weight) return;
  const lossRate = ((formData.weight - currentWeight) / formData.weight) * 100;
  setWeightLossPoints(prev => [...prev, {
    time: currentTime,
    weight: currentWeight,
    lossRate: lossRate,
    tag: currentTag || undefined
  }]);
}

// 记录温度数据
const handleTemperatureRecord = () => {
  if (!isRecording || !currentTemperature) return;
  setTemperaturePoints(prev => [...prev, {
    time: currentTime,
    temperature: currentTemperature,
    tag: currentTag || undefined
  }]);
}
```

### 边距调整注意事项

1. **标签显示空间**
   - 数据点标签需要适度的顶部边距（20px足够）
   - Y轴标签使用正向偏移（10px）使其靠近图表
   - 图例位置预留适量空间

2. **不同曲线类型的考虑**
   - 温度曲线：即使数值较大，10px的左侧边距也足够
   - 失重率曲线：同样使用10px的左侧边距效果良好

3. **自适应调整**
   - 容器大小改变时保持边距比例
   - 数据范围变化时边距仍然适用

### 经验总结

1. 数据流分离是基础
   - 不同类型的数据保持独立
   - 避免强行合并不同性质的数据流

2. 边距设置是关键
   - 使用较小的边距（10-20px）让图表更紧凑
   - Y轴标签使用正向偏移更美观
   - 保持整体视觉平衡